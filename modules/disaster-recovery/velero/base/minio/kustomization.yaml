apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
images:
- name: docker.io/minio/minio
  newTag: RELEASE.2024-04-06T05-26-02Z@sha256:178e05aba3a0dc967df3558aab43097f1427bbcda77264fc24e92f1bf09dfe02
- name: docker.io/minio/mc
  newTag: RELEASE.2024-03-30T15-29-52Z@sha256:c1e6d892a6c73993ca0aef985bebb60820fa21ef4181646648106e44763c07f0
- name: docker.io/velero/velero-plugin-for-aws
  newTag: v1.7.1@sha256:d3fa2219c030533dc2da0cb82c003d947ee6ef33277a71d3184a1e7a2fe6dea3
resources:
- workloads
patches:
- path: patches/velero.yaml
secretGenerator:
- files:
  - workloads/configs/cloud-credentials
  name: cloud-credentials
  type: Opaque
replacements:
- source:
    fieldPath: .metadata.namespace
    kind: Deployment
    name: velero
  targets:
  - fieldPaths:
    - .metadata.namespace
    options:
      create: true
    select:
      labelSelector: app.kubernetes.io/name=minio
  - fieldPaths:
    - .metadata.namespace
    options:
      create: true
    select:
      kind: Secret
      name: cloud-credentials
- source:
    fieldPath: spec.selector.matchLabels
    kind: Deployment
    name: velero
  targets:
  - fieldPaths:
    - spec.ingress.1.from.0.podSelector.matchLabels
    options:
      create: true
    select:
      kind: NetworkPolicy
      name: allow-minio
  - fieldPaths:
    - spec.podSelector.matchLabels
    options:
      create: true
    select:
      kind: NetworkPolicy
      name: allow-velero-minio-egress
